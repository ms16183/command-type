var t=Object.defineProperty,e=(e,s,i)=>((e,s,i)=>s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):e[s]=i)(e,"symbol"!=typeof s?s+"":s,i);import{r as s}from"./phaser-y5S3hZEA.js";!function(){const t=document.createElement("link").relList;if(!(t&&t.supports&&t.supports("modulepreload"))){for(const t of document.querySelectorAll('link[rel="modulepreload"]'))e(t);new MutationObserver((t=>{for(const s of t)if("childList"===s.type)for(const t of s.addedNodes)"LINK"===t.tagName&&"modulepreload"===t.rel&&e(t)})).observe(document,{childList:!0,subtree:!0})}function e(t){if(t.ep)return;t.ep=!0;const e=function(t){const e={};return t.integrity&&(e.integrity=t.integrity),t.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),"use-credentials"===t.crossOrigin?e.credentials="include":"anonymous"===t.crossOrigin?e.credentials="omit":e.credentials="same-origin",e}(t);fetch(t.href,e)}}();var i=s();class r extends i.Scene{constructor(){super("Boot")}preload(){this.load.image("background","assets/bg.png")}create(){this.scene.start("Preloader")}}class n extends i.Scene{constructor(){super("Game"),e(this,"commands",[]),e(this,"currentCommand",null),e(this,"commandIndex",0),e(this,"modelCommand",""),e(this,"typedCommand",""),e(this,"timedEvent",null),e(this,"timerCount",0),e(this,"expire",0),e(this,"correctLetter",0),e(this,"incorrectLetter",0),e(this,"descList",[]),e(this,"inputList",[]),e(this,"outputList",[]),e(this,"rootList",[])}init(){const t=this.cache.json.get("stage");this.descList=t.commands.map((t=>t.description)),this.inputList=t.commands.map((t=>t.input)),this.outputList=t.commands.map((t=>t.output)),this.rootList=t.commands.map((t=>t.root)),this.expire=t.expire}create(){this.cameras.main.setBackgroundColor(0),this.add.image(this.game.config.width/2,this.game.config.height/2,"background"),this.commands=[];for(let t=0;t<this.inputList.length;t++)this.commands.push(this.add.rexBBCodeText(.05*this.game.config.width,.5*this.game.config.height+150*t,this.decoratePrompt(this.inputList[t],this.rootList[t]),{fontFamily:"Consolas",fontSize:36,resolution:3,color:"#737994",stroke:"#000000",strokeThickness:16,align:"left"}).setOrigin(0,.5));this.timerText=this.add.text(10,5,"time: 0",{fontFamily:"Roboto Mono",fontSize:16,color:"#c6d0f5",stroke:"#000000",strokeThickness:4,align:"center"}).setOrigin(0),this.commandIndex=0,this.currentCommand=this.commands[this.commandIndex],this.modelCommand=this.inputList[this.commandIndex],this.typedCommand="",this.input.keyboard.on("keydown",(t=>{if(null===this.timedEvent&&(this.timedEvent=this.time.addEvent({delay:1e3,callback:this.updateText,callbackScope:this,loop:!0})),t.keyCode==Phaser.Input.Keyboard.KeyCodes.ENTER)if(this.typedCommand===this.modelCommand)if(this.currentCommand.appendText(this.outputList[this.commandIndex],!0),this.commandIndex+=1,this.commandIndex<this.commands.length){this.currentCommand=this.commands[this.commandIndex],this.modelCommand=this.inputList[this.commandIndex],this.typedCommand="";for(let t=0;t<this.commands.length;t++)this.tweens.add({targets:this.commands[t],y:this.commands[t].y-150,duration:100,ease:"Power2"})}else this.commandIndex>=this.commands.length&&this.scene.start("GameOver",{time:this.timerCount,correct:0,incorrect:0});else this.cameras.main.shake(300,.005);else t.keyCode==Phaser.Input.Keyboard.KeyCodes.BACKSPACE?this.typedCommand.length>0&&(this.typedCommand=this.typedCommand.substring(0,this.typedCommand.length-1)):(this.isAlpha(t.keyCode)||this.isNumeric(t.keyCode)||this.isSymbol(t.keyCode))&&this.typedCommand.length<this.modelCommand.length&&(this.typedCommand+=t.key);this.correctLetter=0,this.incorrectLetter=0,this.currentCommand.setText(this.decoratePrompt("",this.rootList[this.commandIndex]));for(let e=0;e<this.modelCommand.length;e++)e>=this.typedCommand.length?this.currentCommand.appendText(`[color=#c6d0f5]${this.modelCommand[e]}[/color]`,!1):this.typedCommand[e]===this.modelCommand[e]?this.currentCommand.appendText(`[color=#81c8be]${this.typedCommand[e]}[/color]`,!1):this.currentCommand.appendText(`[color=#e78284]${this.decorateSpace(this.typedCommand[e])}[/color]`,!1)}))}update(){}updateText(){this.timerCount+=1,this.timerText.setText(`time: ${this.timerCount}`),this.expire-this.timerCount<0&&this.scene.start("GameOver",{time:this.timerCount,correct:0,incorrect:0})}decoratePrompt(t,e=!1){return prompt=e?"#":"$",prompt+" "+t}decorateSpace(t){return t.replace(/ /g,"␣")}isNumeric(t){return t==Phaser.Input.Keyboard.KeyCodes.ZERO||t>=Phaser.Input.Keyboard.KeyCodes.ONE&&t<=Phaser.Input.Keyboard.KeyCodes.NINE}isAlpha(t){return t>=Phaser.Input.Keyboard.KeyCodes.A&&t<=Phaser.Input.Keyboard.KeyCodes.Z}isSymbol(t){return t==Phaser.Input.Keyboard.KeyCodes.SPACE||t==Phaser.Input.Keyboard.KeyCodes.SEMICOLON||t==Phaser.Input.Keyboard.KeyCodes.PLUS||t==Phaser.Input.Keyboard.KeyCodes.COMMA||t==Phaser.Input.Keyboard.KeyCodes.MINUS||t==Phaser.Input.Keyboard.KeyCodes.PERIOD||t==Phaser.Input.Keyboard.KeyCodes.FORWARD_SLASH||t==Phaser.Input.Keyboard.KeyCodes.BACK_SLASH||t==Phaser.Input.Keyboard.KeyCodes.QUOTES||t==Phaser.Input.Keyboard.KeyCodes.BACKTICK||t==Phaser.Input.Keyboard.KeyCodes.OPEN_BRACKET||t==Phaser.Input.Keyboard.KeyCodes.CLOSED_BRACKET||t==Phaser.Input.Keyboard.KeyCodes.SEMICOLON_FIREFOX||t==Phaser.Input.Keyboard.KeyCodes.COLON||t==Phaser.Input.Keyboard.KeyCodes.COLON_FIREFOX||t==Phaser.Input.Keyboard.KeyCodes.BRACKET_RIGHT_FIREFOX||t==Phaser.Input.Keyboard.KeyCodes.BRACKET_LEFT_FIREFOX||t==Phaser.Input.Keyboard.KeyCodes.ZERO}}class a extends i.Scene{constructor(){super("GameOver"),e(this,"speedPercentage",0),e(this,"rank","")}init(t){const e=t.time,s=this.cache.json.get("stage");this.speedPercentage=(s.expire-e)/s.expire,console.log(this.speedPercentage)}create(){this.cameras.main.setBackgroundColor(0),this.add.image(512,384,"background"),this.rank="",this.speedPercentage>=.95?this.rank="S+":this.speedPercentage>=.85?this.rank="S":this.speedPercentage>=.75?this.rank="A":this.speedPercentage>=.5?this.rank="B":this.rank="C",this.add.text(512,384,`Rank: ${this.rank}`,{fontFamily:"Arial Black",fontSize:64,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.keyboard.on("keydown",(t=>{t.keyCode!=Phaser.Input.Keyboard.KeyCodes.SPACE||this.scene.start("MainMenu")}))}}class o extends i.Scene{constructor(){super("MainMenu")}create(){this.add.image(this.game.config.width/2,384,"background");let t=this.add.image(this.game.config.width/2,-260,"logo"),e=this.add.text(this.game.config.width/2,-100,"",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"left"}).setOrigin(.5);this.tweens.add({targets:t,y:300,ease:"back.out",delay:500,duration:1e3}),this.tweens.add({targets:e,y:460,ease:"back.out",delay:500,duration:1e3});let s=this.cache.json.get("stage");e.setText("Space -『"+s.title+"』をプレイ\nTab - クレジット"),this.input.keyboard.on("keydown",(t=>{t.keyCode!=Phaser.Input.Keyboard.KeyCodes.SPACE?t.keyCode!=Phaser.Input.Keyboard.KeyCodes.TAB||this.scene.start("Credit"):this.scene.start("Game")}))}}class h extends i.Scene{constructor(){super("Credit")}create(){this.add.text(512,300,"Credit\nJohn Doe\n",{fontFamily:"Arial Black",fontSize:38,color:"#ffffff",stroke:"#000000",strokeThickness:8,align:"center"}).setOrigin(.5),this.input.keyboard.on("keydown",(()=>{this.scene.start("MainMenu")}))}}class l extends i.Scene{constructor(){super("Preloader")}init(){this.add.image(512,384,"background"),this.add.rectangle(512,384,468,32).setStrokeStyle(1,16777215);const t=this.add.rectangle(282,384,4,28,16777215);this.load.on("progress",(e=>{t.width=4+460*e}))}preload(){this.load.setPath("assets"),this.load.image("logo","logo.png"),this.cache.json.add("stage",window.stageData)}create(){this.scene.start("MainMenu")}}var d=Phaser.Renderer.WebGL.Utils;const u={renderWebGL:function(t,e,s,i){if(0!==e.width&&0!==e.height){s.addToRenderList(e);var r=e.frame,n=r.width,a=r.height,o=d.getTintAppendFloatAlpha,h=t.pipelines.set(e.pipeline,e),l=h.setTexture2D(r.glTexture,e);t.pipelines.preBatch(e),h.batchTexture(e,r.glTexture,n,a,e.x,e.y,n/e.style.resolution,a/e.style.resolution,e.scaleX,e.scaleY,e.rotation,e.flipX,e.flipY,e.scrollFactorX,e.scrollFactorY,e.displayOriginX,e.displayOriginY,0,0,n,a,o(e.tintTopLeft,s.alpha*e._alphaTL),o(e.tintTopRight,s.alpha*e._alphaTR),o(e.tintBottomLeft,s.alpha*e._alphaBL),o(e.tintBottomRight,s.alpha*e._alphaBR),e.tintFill,0,0,s,i,!1,l),t.pipelines.postBatch(e)}},renderCanvas:function(t,e,s,i){0!==e.width&&0!==e.height&&(s.addToRenderList(e),t.batchSprite(e,e.frame,s,i))}},c=Phaser.Display.Canvas.CanvasPool;var g=!1;!function(t){if(!g){void 0===t&&(t=60);var e=Phaser.VERSION.split("."),s=parseInt(e[0]);if(3===s){var i=parseInt(e[1]);i<t&&console.error(`Minimum supported version : ${s}.${i}`)}else console.error(`Can't supported version : ${s}`);g=!0}}();const p=Phaser.GameObjects.GameObject;class f extends p{setStyle(t){return this.style.setStyle(t)}setFont(t){return this.style.setFont(t)}setFontFamily(t){return this.style.setFontFamily(t)}setFontSize(t){return this.style.setFontSize(t)}setFontStyle(t){return this.style.setFontStyle(t)}setTestString(t){return this.style.setTestString(t)}setFixedSize(t,e){return this.style.setFixedSize(t,e)}setBackgroundColor(t,e,s){return this.style.setBackgroundColor(t,e,s)}setBackgroundStrokeColor(t,e){return this.style.setBackgroundStrokeColor(t,e)}setBackgroundCornerRadius(t,e){return this.style.setBackgroundCornerRadius(t,e)}setFill(t){return this.style.setFill(t)}setColor(t){return this.style.setColor(t)}setStroke(t,e){return this.style.setStroke(t,e)}setShadow(t,e,s,i,r,n){return this.style.setShadow(t,e,s,i,r,n)}setShadowOffset(t,e){return this.style.setShadowOffset(t,e)}setShadowColor(t){return this.style.setShadowColor(t)}setShadowBlur(t){return this.style.setShadowBlur(t)}setShadowStroke(t){return this.style.setShadowStroke(t)}setShadowFill(t){return this.style.setShadowFill(t)}setUnderline(t,e,s){return this.style.setUnderline(t,e,s)}setUnderlineColor(t){return this.style.setUnderlineColor(t)}setUnderlineThickness(t){return this.style.setUnderlineThickness(t)}setUnderlineOffset(t){return this.style.setUnderlineOffset(t)}setStrikethrough(t,e,s){return this.style.setStrikethrough(t,e,s)}setStrikethroughColor(t){return this.style.setStrikethroughColor(t)}setStrikethroughThickness(t){return this.style.setStrikethroughThickness(t)}setStrikethroughOffset(t){return this.style.setStrikethroughOffset(t)}setWrapMode(t){return this.style.setWrapMode(t)}setWrapWidth(t){return this.style.setWrapWidth(t)}setWordWrapWidth(t){return this.style.setWrapWidth(t)}setAlign(t){return this.style.setHAlign(t)}setHAlign(t){return this.style.setHAlign(t)}setVAlign(t){return this.style.setVAlign(t)}get lineSpacing(){return this.style.lineSpacing}set lineSpacing(t){this.style.lineSpacing=t}setLineSpacing(t){return this.style.lineSpacing=t,this.updateText(!0),this}setXOffset(t){return this.style.setXOffset(t)}setMaxLines(t){return this.style.setMaxLines(t)}setResolution(t){return this.style.setResolution(t)}getTextMetrics(){return this.style.getTextMetrics()}setTextMetrics(t,e){return this.style.setTextMetrics(t,e)}measureTextMargins(t,e){return function(t,e,s){void 0===s&&(s={});var i=c.create(this),r=i.getContext("2d",{willReadFrequently:!0});t.syncFont(i,r);var n=r.measureText(e),a=Math.ceil(n.width*t.baselineX),o=a,h=2*o;if(o=o*t.baselineY|0,i.width=a,i.height=h,r.fillStyle="#f00",r.fillRect(0,0,a,h),r.font=t._font,r.textBaseline="alphabetic",r.fillStyle="#000",r.fillText(t.testString,0,o),s.left=0,0===a||0===h||!r.getImageData(0,0,a,h))return c.remove(i),s;for(var l=r.getImageData(0,0,a,h).data,d=!1,u=0;u<a;u++){for(var g=0;g<h;g++)if(255!==l[4*(g*a+u)]){s.left=u,d=!0;break}if(d)break}return c.remove(i),s}(this.style,t,e)}}const y=Phaser.GameObjects.Components;Phaser.Class.mixin(f,[y.Alpha,y.BlendMode,y.ComputedSize,y.Crop,y.Depth,y.Flip,y.GetBounds,y.Mask,y.Origin,y.Pipeline,y.PostPipeline,y.ScrollFactor,y.Tint,y.Transform,y.Visible,u]);const m=Phaser.Utils.String.Pad;var v=function(t,e,s){if(null==t)return t;switch(typeof t){case"string":default:return t;case"number":return`#${m(Math.floor(t).toString(16),6,"0",1)}`;case"function":return t(e,s);case"object":return t.hasOwnProperty("r")?t.hasOwnProperty("a")?`rgba(${t.r},${t.g},${t.b},${t.a})`:`rgb(${t.r},${t.g},${t.b})`:t.hasOwnProperty("h")?t.hasOwnProperty("a")?`hsla(${t.h},${t.s},${t.l},${t.a})`:`hsl(${t.h},${t.s},${t.l})`:t}},x={backgroundColor:["backgroundColor",null,v],backgroundColor2:["backgroundColor2",null,v],backgroundHorizontalGradient:["backgroundHorizontalGradient",!0,null],backgroundStrokeColor:["backgroundStrokeColor",null,v],backgroundStrokeLineWidth:["backgroundStrokeLineWidth",2,null],backgroundCornerRadius:["backgroundCornerRadius",0,null],backgroundCornerIteration:["backgroundCornerIteration",null,null],fontFamily:["fontFamily","Courier",null],fontSize:["fontSize","16px",null],fontStyle:["fontStyle","",null],color:["color","#fff",v],stroke:["stroke","#fff",v],strokeThickness:["strokeThickness",0,null],shadowOffsetX:["shadow.offsetX",0,null],shadowOffsetY:["shadow.offsetY",0,null],shadowColor:["shadow.color","#000",v],shadowBlur:["shadow.blur",0,null],shadowStroke:["shadow.stroke",!1,null],shadowFill:["shadow.fill",!1,null],underlineColor:["underline.color","#000",v],underlineThickness:["underline.thickness",0,null],underlineOffset:["underline.offset",0,null],strikethroughColor:["strikethrough.color","#000",v],strikethroughThickness:["strikethrough.thickness",0,null],strikethroughOffset:["strikethrough.offset",0,null],halign:["halign","left",null],valign:["valign","top",null],maxLines:["maxLines",0,null],fixedWidth:["fixedWidth",0,null],fixedHeight:["fixedHeight",0,null],resolution:["resolution",0,null],lineSpacing:["lineSpacing",0,null],xOffset:["xOffset",0,null],rtl:["rtl",!1,null],testString:["testString","|MÃ‰qgy",null],baselineX:["baselineX",1.2,null],baselineY:["baselineY",1.4,null],wrapMode:["wrap.mode",0,null],wrapWidth:["wrap.width",0,null],wrapCallback:["wrap.callback",null],wrapCallbackScope:["wrap.callbackScope",null]};const w=Phaser.Display.Canvas.CanvasPool;var S=function(t){var e=w.create(this),s=e.getContext("2d",{willReadFrequently:!0});t.syncFont(e,s);var i=s.measureText(t.testString);if("actualBoundingBoxAscent"in i){var r=i.actualBoundingBoxAscent,n=i.actualBoundingBoxDescent,a={ascent:r,descent:n,fontSize:r+n};return w.remove(e),a}var o=Math.ceil(i.width*t.baselineX),h=o,l=2*h;if(h=h*t.baselineY|0,e.width=o,e.height=l,s.fillStyle="#f00",s.fillRect(0,0,o,l),s.font=t._font,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(t.testString,0,h),a={ascent:0,descent:0,fontSize:0},!s.getImageData(0,0,o,l))return a.ascent=h,a.descent=h+6,a.fontSize=a.ascent+a.descent,w.remove(e),a;var d,u,c=s.getImageData(0,0,o,l).data,g=c.length,p=4*o,f=0,y=!1;for(d=0;d<h;d++){for(u=0;u<p;u+=4)if(255!==c[f+u]){y=!0;break}if(y)break;f+=p}for(a.ascent=h-d,f=g-p,y=!1,d=l;d>h;d--){for(u=0;u<p;u+=4)if(255!==c[f+u]){y=!0;break}if(y)break;f-=p}return a.descent=d-h,a.fontSize=a.ascent+a.descent,w.remove(e),a},E=/(?:\r\n|\r|\n)/;const O={none:0,word:1,char:2,character:2,mix:3},C=Phaser.Utils.Objects.GetAdvancedValue,T=Phaser.Utils.Objects.GetValue;class k{constructor(t,e,s){this.parent=t,void 0===s&&(s=x),this.propertyMap=s,this.backgroundColor,this.backgroundColor2,this.backgroundHorizontalGradient,this.backgroundStrokeColor,this.backgroundStrokeLineWidth,this.backgroundCornerRadius,this.backgroundCornerIteration,this.fontFamily,this.fontSize,this.fontStyle,this.color,this.stroke,this.strokeThickness,this.shadowOffsetX,this.shadowOffsetY,this.shadowColor,this.shadowBlur,this.shadowStroke,this.shadowFill,this.underlineColor,this.underlineThickness,this.underlineOffset,this.strikethroughColor,this.strikethroughThickness,this.strikethroughOffset,this.halign,this.valign,this.maxLines,this.fixedWidth,this.fixedHeight,this.resolution,this.xOffset,this.rtl,this.testString,this.baselineX,this.baselineY,this.wrapMode,this.wrapWidth,this.wrapCallback,this.wrapCallbackScope,this._font,this.setStyle(e,!1,!0)}get isWrapFitMode(){return this.fixedWidth>0&&0!==this.wrapMode&&0===this.wrapWidth}setStyle(t,e,s){if(void 0===e&&(e=!0),void 0===s&&(s=!1),t&&t.hasOwnProperty("wordWrap")){var i=t.wordWrap;i.hasOwnProperty("width")&&(t.wrap={mode:"word",width:i.width})}if(t&&t.hasOwnProperty("wrap")){var r=t.wrap;if(r.hasOwnProperty("mode")){var n=r.mode;"string"==typeof n&&(r.mode=O[n])}else r.hasOwnProperty("width")&&(r.mode=1)}t&&t.rtl&&s&&!t.hasOwnProperty("halign")&&(t.halign="right"),t&&t.hasOwnProperty("fontSize")&&"number"==typeof t.fontSize&&(t.fontSize=t.fontSize.toString()+"px");var a=this.propertyMap;for(var o in a){var h=a[o],l=h[0],d=s?h[1]:this[o],u=h[2];if("wrapCallback"===o||"wrapCallbackScope"===o)this[o]=T(t,l,d);else{var c=C(t,l,d);u&&(c=u(c)),this[o]=c}}var g=T(t,"font",null);this._font=null===g?this.fontStyle+" "+this.fontSize+" "+this.fontFamily:g;var p=T(t,"fill",null);null!==p&&(this.color=v(p));var f=T(t,"metrics",!1);return f?this.metrics={ascent:T(f,"ascent",0),descent:T(f,"descent",0),fontSize:T(f,"fontSize",0)}:!e&&this.metrics||(this.metrics=S(this)),e?this.parent.updateText():this.parent}syncFont(t,e){e.font=this._font}syncStyle(t,e){e.textBaseline="alphabetic",e.fillStyle=this.color,e.strokeStyle=this.stroke,e.lineWidth=this.strokeThickness,e.lineCap="round",e.lineJoin="round"}syncShadow(t,e){e?(t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowColor=this.shadowColor,t.shadowBlur=this.shadowBlur):(t.shadowOffsetX=0,t.shadowOffsetY=0,t.shadowColor=0,t.shadowBlur=0)}update(t){return t&&(this._font=`${this.fontStyle} ${this.fontSize} ${this.fontFamily}`.trim(),this.metrics=S(this)),this.parent.updateText(t)}buildFont(){var t=`${this.fontStyle} ${this.fontSize} ${this.fontFamily}`.trim();return t!==this._font&&(this._font=t),this}setFont(t){return"string"==typeof t?(this.fontFamily=t,this.fontSize="",this.fontStyle=""):(this.fontFamily=T(t,"fontFamily","Courier"),this.fontSize=T(t,"fontSize","16px"),this.fontStyle=T(t,"fontStyle","")),this.update(!0)}setFontFamily(t){return this.fontFamily=t,this.update(!0)}setFontStyle(t){return this.fontStyle=t,this.update(!0)}setFontSize(t){return"number"==typeof t&&(t=t.toString()+"px"),this.fontSize=t,this.update(!0)}setTestString(t){return this.testString=t,this.update(!0)}setFixedSize(t,e){return this.fixedWidth=t,this.fixedHeight=e,t&&(this.parent.width=t),e&&(this.parent.height=e),this.update(this.isWrapFitMode)}setResolution(t){return this.resolution=t,this.update(!1)}setXOffset(t){return this.xOffset=t,this.update(!1)}setBackgroundColor(t,e,s){return void 0===s&&(s=!0),this.backgroundColor=v(t,this.parent.canvas,this.parent.context),this.backgroundColor2=v(e,this.parent.canvas,this.parent.context),this.backgroundHorizontalGradient=s,this.update(!1)}setBackgroundStrokeColor(t,e){return this.backgroundStrokeColor=v(t,this.parent.canvas,this.parent.context),this.backgroundStrokeLineWidth=e,this.update(!1)}setBackgroundCornerRadius(t,e){return this.backgroundCornerRadius=t,this.backgroundCornerIteration=e,this.update(!1)}setFill(t){return this.color=v(t,this.parent.canvas,this.parent.context),this.update(!1)}setColor(t){return this.color=v(t,this.parent.canvas,this.parent.context),this.update(!1)}setStroke(t,e){return void 0===t?this.strokeThickness=0:(void 0===e&&(e=this.strokeThickness),this.stroke=v(t,this.parent.canvas,this.parent.context),this.strokeThickness=e),this.update(!0)}setShadow(t,e,s,i,r,n){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===s&&(s="#000"),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===n&&(n=!0),this.shadowOffsetX=t,this.shadowOffsetY=e,this.shadowColor=v(s,this.parent.canvas,this.parent.context),this.shadowBlur=i,this.shadowStroke=r,this.shadowFill=n,this.update(!1)}setShadowOffset(t,e){return void 0===t&&(t=0),void 0===e&&(e=t),this.shadowOffsetX=t,this.shadowOffsetY=e,this.update(!1)}setShadowColor(t){return void 0===t&&(t="#000"),this.shadowColor=v(t,this.parent.canvas,this.parent.context),this.update(!1)}setShadowBlur(t){return void 0===t&&(t=0),this.shadowBlur=t,this.update(!1)}setShadowStroke(t){return this.shadowStroke=t,this.update(!1)}setShadowFill(t){return this.shadowFill=t,this.update(!1)}setUnderline(t,e,s){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===s&&(s=0),this.underlineColor=v(t,this.parent.canvas,this.parent.context),this.underlineThickness=e,this.underlineOffset=s,this.update(!1)}setUnderlineColor(t){return void 0===t&&(t="#000"),this.underlineColor=v(t,this.parent.canvas,this.parent.context),this.update(!1)}setUnderlineThickness(t){return void 0===t&&(t=0),this.underlineThickness=t,this.update(!1)}setUnderlineOffset(t){return void 0===t&&(t=0),this.underlineOffset=t,this.update(!1)}setStrikethrough(t,e,s){return void 0===t&&(t="#000"),void 0===e&&(e=0),void 0===s&&(s=0),this.strikethroughColor=v(t,this.parent.canvas,this.parent.context),this.strikethroughThickness=e,this.strikethroughOffset=s,this.update(!1)}setStrikethroughColor(t){return void 0===t&&(t="#000"),this.strikethroughColor=v(t,this.parent.canvas,this.parent.context),this.update(!1)}setStrikethroughThickness(t){return void 0===t&&(t=0),this.strikethroughThickness=t,this.update(!1)}setStrikethroughOffset(t){return void 0===t&&(t=0),this.strikethroughOffset=t,this.update(!1)}setWrapMode(t){return"string"==typeof t&&(t=O[t.toLowerCase()]||0),this.wrapMode=t,this.update(!0)}setWrapWidth(t){return this.wrapWidth=t,this.update(!1)}setAlign(t,e){return void 0===t&&(t="left"),void 0===e&&(e="top"),this.halign=t,this.valign=e,this.update(!1)}setHAlign(t){return void 0===t&&(t="left"),this.halign=t,this.update(!1)}setVAlign(t){return void 0===t&&(t="top"),this.valign=t,this.update(!1)}setMaxLines(t){return void 0===t&&(t=0),this.maxLines=t,this.update(!1)}getTextMetrics(){var t=this.metrics;return{ascent:t.ascent,descent:t.descent,fontSize:t.fontSize}}setTextMetrics(t,e){return this.metrics.ascent=t.ascent,this.metrics.descent=t.descent,this.metrics.fontSize=t.fontSize,e&&("string"==typeof e?(this.fontFamily=e,this.fontSize="",this.fontStyle=""):(this.fontFamily=T(e,"fontFamily",this.fontFamily),this.fontSize=T(e,"fontSize",this.fontSize),this.fontStyle=T(e,"fontStyle",this.fontStyle))),this.parent.updateText(!0)}get lineHeight(){return this.metrics.fontSize+this.parent.lineSpacing}toJSON(){var t={},e=this.propertyMap;for(var s in e)t[s]=this[s];return t.metrics=this.getTextMetrics(),t}destroy(){this.parent=void 0}}const R=Phaser.Utils.Objects.GetValue;class P{constructor(t,e,s,i,r){void 0===t&&(t=0),void 0===e&&(e=t),void 0===s&&(s=0),void 0===i&&(i=0),void 0===r&&(r=0),this.cornerRadius={},this._width=0,this._height=0,this.setTo(t,e,s,i,r)}setTo(t,e,s,i,r){return this.setPosition(t,e),this.setRadius(r),this.setSize(s,i),this}setPosition(t,e){return this.x=t,this.y=e,this}setRadius(t){return void 0===t&&(t=0),this.radius=t,this}setSize(t,e){return this.width=t,this.height=e,this}get minWidth(){var t=this.cornerRadius;return Math.max(t.tl.x+t.tr.x,t.bl.x+t.br.x)}get minHeight(){var t=this.cornerRadius;return Math.max(t.tl.y+t.bl.y,t.tr.y+t.br.y)}get width(){return this._width}set width(t){null==t&&(t=0),this._width=Math.max(t,this.minWidth)}get height(){return this._height}set height(t){null==t&&(t=0),this._height=Math.max(t,this.minHeight)}get radius(){var t=this.cornerRadius;return Math.max(t.tl.x,t.tl.y,t.tr.x,t.tr.y,t.bl.x,t.bl.y,t.br.x,t.br.y)}set radius(t){var e,s;"number"==typeof t?(e=t,s=t):(e=R(t,"x",0),s=R(t,"y",0));var i=this.cornerRadius;i.tl=_(R(t,"tl",void 0),e,s),i.tr=_(R(t,"tr",void 0),e,s),i.bl=_(R(t,"bl",void 0),e,s),i.br=_(R(t,"br",void 0),e,s)}get radiusTL(){var t=this.cornerRadius.tl;return Math.max(t.x,t.y)}set radiusTL(t){b(this.cornerRadius.tl,t)}get radiusTR(){var t=this.cornerRadius.tr;return Math.max(t.x,t.y)}set radiusTR(t){b(this.cornerRadius.tr,t)}get radiusBL(){var t=this.cornerRadius.bl;return Math.max(t.x,t.y)}set radiusBL(t){b(this.cornerRadius.bl,t)}get radiusBR(){var t=this.cornerRadius.br;return Math.max(t.x,t.y)}set radiusBR(t){b(this.cornerRadius.br,t)}}var _=function(t,e,s){return void 0===t?t={x:e,y:s}:"number"==typeof t&&(t={x:t,y:t}),L(t),t},b=function(t,e){"number"==typeof e?(t.x=e,t.y=e):(t.x=R(e,"x",0),t.y=R(e,"y",0)),L(t)},L=function(t){t.convex=t.x>=0||t.y>=0,t.x=Math.abs(t.x),t.y=Math.abs(t.y)};const M=Phaser.Math.DegToRad;var I=function(t){return!t.hasOwnProperty("convex")||t.convex},A=function(t){return t.x>0&&t.y>0},F=function(t,e,s,i,r,n,a,o,h){if(o&&a>n?a-=360:!o&&a<n&&(a+=360),n=M(n),a=M(a),null==h)t.ellipse(e,s,i,r,0,n,a,o);else for(var l,d,u,c=(a-n)/(h+=1),g=0;g<=h;g++)u=n+c*g,l=e+i*Math.cos(u),d=s+r*Math.sin(u),t.lineTo(l,d)};const N={draw(t,e,s,i){var r=this.penManager;this.hitAreaManager.clear();var n=this.context;n.save();var a=this.defaultStyle;this.clear(),function(t,e,s,i,r,n,a,o){if(null!=e||null!=s){var h=t.canvas.width,l=t.canvas.height;null==s&&(i=0);var d=i/2;h=Math.max(1,h-i),l=Math.max(1,l-i),function(t,e,s,i,r,n,a,o,h,l,d,u,c){var g;(function(t,e,s,i,r,n,a){var o,h,l,d,u,c=new P(e,s,i,r,n),g=c.minWidth,p=c.minHeight,f=i>=g?1:i/g,y=r>=p?1:r/p,m=c.cornerRadius;t.save(),t.beginPath(),t.translate(e,s),o=m.tl,A(o)?(h=o.x*f,l=o.y*y,I(o)?F(t,h,l,h,l,180,270,!1,a):F(t,0,0,h,l,90,0,!0,a),d=0,u=l):(t.lineTo(0,0),d=0,u=0),o=m.tr,A(o)?(h=o.x*f,l=o.y*y,I(o)?F(t,i-h,l,h,l,270,360,!1,a):F(t,i,0,h,l,180,90,!0,a)):t.lineTo(i,0),o=m.br,A(o)?(h=o.x*f,l=o.y*y,I(o)?F(t,i-h,r-l,h,l,0,90,!1,a):F(t,i,r,h,l,270,180,!0,a)):t.lineTo(i,r),o=m.bl,A(o)?(h=o.x*f,l=o.y*y,I(o)?F(t,h,r-l,h,l,90,180,!1,a):F(t,0,r,h,l,360,270,!0,a)):t.lineTo(0,r),t.lineTo(d,u),t.closePath(),t.restore()})(e,s,i,r,n,a,c),null!=o&&(null!=d&&((g=u?e.createLinearGradient(0,0,r,0):e.createLinearGradient(0,0,0,n)).addColorStop(0,o),g.addColorStop(1,d),o=g),e.fillStyle=o,e.fill()),null!=h&&l>0&&(e.strokeStyle=h,e.lineWidth=l,e.stroke())}(t.canvas,t.context,d,d,h,l,r,e,s,i,n,a,o)}}(this,a.backgroundColor,a.backgroundStrokeColor,a.backgroundStrokeLineWidth,a.backgroundCornerRadius,a.backgroundColor2,a.backgroundHorizontalGradient,a.backgroundCornerIteration),t+=this.startXOffset,e+=this.startYOffset;var o,h,l,d,u,c,g=a.halign,p=a.valign,f=a.lineHeight,y=r.lines,m=y.length,v=a.maxLines;v>0&&m>v?(h=v,l="center"===p?Math.floor((m-h)/2):"bottom"===p?m-h:0):(h=m,l=0),d=l+h;var x=this.rtl,w=x?this.parent.width:void 0;c="center"===p?Math.max((i-h*f)/2,0):"bottom"===p?Math.max(i-h*f-2,0):0,c+=e;for(var S=l;S<d;S++)if(0!==(o=r.getLineWidth(S))){for(var E=y[S],O=E.length,C=g,T=0;T<O;T++){var k=E[T].prop.align;if(void 0!==k){C=k;break}}for(u="center"===C?(s-o)/2:"right"===C?x?0:s-o:x?s-o:0,u+=t,T=0;T<O;T++)this.drawPen(E[T],u,c,w)}n.restore()},drawPen(t,e,s,i){e+=t.x,s+=t.y+(t.prop.y||0),void 0!==i&&(e=i-e);var r=this.canvas,n=this.context;n.save();var a=this.parser.propToContextStyle(this.defaultStyle,t.prop);if(null!==a.bgcolor&&t.width>0){var o=this.defaultStyle.metrics,h=s-o.ascent,l=o.fontSize;this.drawRectangle(e,h,t.width,l,a.bgcolor,a)}if(a.underlineThickness>0&&t.width>0){var d=s+a.underlineOffset-a.underlineThickness/2;this.drawLine(e,d,t.width,a.underlineThickness,a.underlineColor,a)}if(t.isTextPen&&(a.buildFont(),a.syncFont(r,n),a.syncStyle(r,n),this.drawText(e,s,t.text,a)),t.isImagePen&&this.drawImage(e,s,t.prop.img,t.prop.color,a),a.strikethroughThickness>0&&t.width>0&&(d=s+a.strikethroughOffset-a.strikethroughThickness/2,this.drawLine(e,d,t.width,a.strikethroughThickness,a.strikethroughColor,a)),n.restore(),t.hasAreaMarker&&t.width>0){var u,c=t.prop.area;if(c)u={key:c};else{var g=t.prop.url;u={key:`url:${g}`,url:g}}this.hitAreaManager.add(e,s-this.startYOffset,t.width,this.defaultStyle.lineHeight,u)}},clear(){var t=this.canvas;this.context.clearRect(0,0,t.width,t.height)},drawRectangle(t,e,s,i,r,n){this.autoRound&&(t=Math.round(t),e=Math.round(e));var a=this.context;a.fillStyle=r,a.fillRect(t,e,s,i)},drawLine(t,e,s,i,r,n){this.autoRound&&(t=Math.round(t),e=Math.round(e));var a=this.context;n.syncShadow(a,n.shadowStroke);var o=a.lineCap;a.lineCap="butt",a.strokeStyle=r,a.lineWidth=i,a.beginPath(),a.moveTo(t,e),a.lineTo(t+s,e),a.stroke(),a.lineCap=o},drawText(t,e,s,i){this.autoRound&&(t=Math.round(t),e=Math.round(e));var r=this.context;i.stroke&&"none"!==i.stroke&&i.strokeThickness>0&&(i.syncShadow(r,i.shadowStroke),r.strokeText(s,t,e)),i.color&&"none"!==i.color&&(i.syncShadow(r,i.shadowFill),r.fillText(s,t,e))},drawImage(t,e,s,i,r){e-=this.startYOffset,this.parent.imageManager.draw(s,this.context,t,e,i,this.autoRound)}},K=Phaser.Utils.Objects.GetValue;class W{constructor(t){this.prop={},this.resetFromJSON(t)}resetFromJSON(t){this.text=K(t,"text",""),this.x=K(t,"x",0),this.y=K(t,"y",0),this.width=K(t,"width",0);var e=K(t,"prop",null);null===e&&(e={}),this.prop=e,this.newLineMode=K(t,"newLineMode",0),this.startIndex=K(t,"startIndex",0)}get plainText(){var t=this.text;return 1===this.newLineMode&&(t+="\n"),t}get wrapText(){var t=this.text;return 0!==this.newLineMode&&(t+="\n"),t}get rawTextLength(){var t=this.text.length;return 1===this.newLineMode&&(t+=1),t}get endIndex(){return this.startIndex+this.rawTextLength}get lastX(){return this.x+this.width}get isTextPen(){return""!==this.text}get isImagePen(){return!!this.prop.img}get hasAreaMarker(){return!!this.prop.area||!!this.prop.url}}var B=function(t,e){var s=Array.isArray(t);if(void 0===e?e=s?[]:{}:function(t){if("object"!=typeof t||null===t)return t;if(Array.isArray(t))t.length=0;else for(var e in t)delete t[e]}(e),s){e.length=t.length;for(var i=0,r=t.length;i<r;i++)e[i]=t[i]}else for(var n in t)e[n]=t[n];return e},H=function(){};const $=Phaser.Utils.Objects.GetFastValue;class G{constructor(t){this.pens=[],this.lines=[],this.maxLinesWidth=void 0,this.pensPool=t.pensPool,this.linesPool=t.linesPool,this.tagToText=$(t,"tagToText",H),this.tagToTextScope=$(t,"tagToTextScope",void 0)}destroy(){this.clear(),this.tagToText=void 0,this.tagToTextScope=void 0}clear(){for(var t=0,e=this.lines.length;t<e;t++)this.lines[t].length=0;this.pensPool.pushMultiple(this.pens),this.linesPool.pushMultiple(this.lines),this.maxLinesWidth=void 0}addTextPen(t,e,s,i,r,n){var a=this.pensPool.pop();return null==a&&(a=new W),z.text=t,z.x=e,z.y=s,z.width=i,z.prop=r,z.newLineMode=n,a.resetFromJSON(z),this.addPen(a),this}addImagePen(t,e,s,i){return this.addTextPen("",t,e,s,i,0),this}addNewLinePen(){var t=this.lastPen,e=t?t.lastX:0,s=t?t.y:0,i=t?B(t.prop):null;return this.addTextPen("",e,s,0,i,2),this}addPen(t){var e=this.lastPen;t.startIndex=null==e?0:e.endIndex,this.pens.push(t);var s=this.lastLine;null==s&&(s=this.linesPool.pop()||[],this.lines.push(s)),s.push(t),0!==t.newLineMode&&(s=this.linesPool.pop()||[],this.lines.push(s)),this.maxLinesWidth=void 0}clone(t){null==t&&(t=new G),t.clear();for(var e=0,s=this.lines.length;e<s;e++)for(var i=this.lines[e],r=0,n=i.length;r<n;r++){var a=i[r];t.addPen(a.text,a.x,a.y,a.width,B(a.prop),a.newLineMode)}return t}get lastPen(){return this.pens[this.pens.length-1]}get lastLine(){return this.lines[this.lines.length-1]}getLineStartIndex(t){if(t>=this.lines.length)return this.getLineEndIndex(t);var e=this.lines[t];return e&&e[0]?e[0].startIndex:0}getLineEndIndex(t){t>=this.lines.length&&(t=this.lines.length-1);var e,s,i=!1;for(e=t;e>=0&&!(i=null!=(s=this.lines[e])&&s.length>0);e--);return i?s[s.length-1].endIndex:0}getLineWidth(t){var e=this.lines[t];if(!e)return 0;var s=e[e.length-1];return null==s?0:s.lastX}getMaxLineWidth(){if(void 0!==this.maxLinesWidth)return this.maxLinesWidth;for(var t,e=0,s=0,i=this.lines.length;s<i;s++)(t=this.getLineWidth(s))>e&&(e=t);return this.maxLinesWidth=e,e}getLineWidths(){for(var t=[],e=0,s=this.lines.length;e<s;e++)t.push(this.getLineWidth(e));return t}get linesCount(){return this.lines.length}get plainText(){for(var t="",e=this.pens,s=0,i=e.length;s<i;s++)t+=e[s].plainText;return t}get rawTextLength(){for(var t=0,e=this.pens,s=0,i=this.pens.length;s<i;s++)t+=e[s].rawTextLength;return t}getSliceTagText(t,e,s){var i=this.lastPen;if(null==i)return"";var r=i.endIndex;void 0!==t&&0!==t||(t=-1),void 0!==e&&e!==r||(e=r+1),void 0===s&&(s=!1);for(var n,a,o,h,l,d,u="",c=0,g=this.pens.length;c<g&&((h=(n=this.pens[c]).endIndex)<=t||(n=this.pens[c],a=s?n.wrapText:n.plainText,l=n.prop,(o=n.startIndex)>=t&&h<=e||(a=a.substring(t-o,e-o)),this.tagToTextScope?u+=this.tagToText.call(this.tagToTextScope,a,l,d):u+=this.tagToText(a,l,d),d=l,!(h>=e)));c++);return u}get length(){return this.lines.length}set length(t){this.clear()}}var z={};class D{constructor(){this.items=[]}destroy(){this.clear(),this.items=void 0}pop(){return this.items.length>0?this.items.pop():null}push(t){return this.items.push(t),this}pushMultiple(t){return this.items.push.apply(this.items,t),t.length=0,this}clear(){return this.items.length=0,this}}const U=Phaser.Geom.Rectangle;var X=new D;class j{constructor(){this.hitAreas=[]}destroy(){this.clear()}clear(){for(var t=0,e=this.hitAreas.length;t<e;t++)this.hitAreas[t].data=null;return X.pushMultiple(this.hitAreas),this}add(t,e,s,i,r){void 0===r&&(r={});var n=X.pop();return null===n?n=new U(t,e,s,i):n.setTo(t,e,s,i),n.data=r,this.hitAreas.push(n),this}getFirst(t,e){for(var s=0,i=this.hitAreas.length;s<i;s++){var r=this.hitAreas[s];if(r.contains(t,e))return r}return null}getByKey(t){for(var e=0,s=this.hitAreas.length;e<s;e++){var i=this.hitAreas[e];if(i.data.key===t)return i}return null}drawBounds(t,e,s){void 0===e&&(e=16777215),s&&t.save().translateCanvas(s.x,s.y).rotateCanvas(s.rotation).scaleCanvas(s.scaleX,s.scaleY);for(var i=0,r=this.hitAreas.length;i<r;i++){var n=this.hitAreas[i];t.lineStyle(1,e).strokeRect(n.x,n.y,n.width,n.height)}return s&&t.restore(),this}}var Y=function(t,e,s,i){var r=this.hitAreaManager.getFirst(e,s);if(null!==r){var n=r.data.key;Z.call(this,"areadown",n,t,e,s,i),r.data&&(r.data.isDown=!0)}},V=function(t,e,s,i){var r=this.hitAreaManager.getFirst(e,s);if(null!==r){var n=r.data.key;if(Z.call(this,"areaup",n,t,e,s,i),r.data){if(r.data.isDown){if(Z.call(this,"areaclick",n,t,e,s,i),!r.data)return;var a=r.data.url;a&&window.open(a,"_blank")}r.data.isDown=!1}}},J=function(t,e,s,i){if(null!==e){var r=(a=this.hitAreaManager.getFirst(e,s))?a.data.key:null;if(this.lastHitAreaKey!==r){if(null!==this.lastHitAreaKey){Z.call(this,"areaout",this.lastHitAreaKey,t,e,s,i);var n=this.hitAreaManager.getByKey(this.lastHitAreaKey);n&&(this.urlTagCursorStyle&&q(this.scene,n,""),n.data.isDown=!1)}null!==r&&(Z.call(this,"areaover",r,t,e,s,i),a.data&&this.urlTagCursorStyle&&q(this.scene,a,this.urlTagCursorStyle)),this.lastHitAreaKey=r}}else{var a;null!==this.lastHitAreaKey&&(Z.call(this,"areaout",this.lastHitAreaKey,t,e,s,i),(a=this.hitAreaManager.getByKey(this.lastHitAreaKey))&&a.data&&(a.data.isDown=!1),this.lastHitAreaKey=null)}},Z=function(t,e,s,i,r,n){this.parent.emit(`${t}-${e}`,s,i,r,n),this.parent.emit(t,e,s,i,r,n)},q=function(t,e,s){e&&e.data&&e.data.url&&(t.input.manager.canvas.style.cursor=s)};const Q=Phaser.GameObjects.Components.TransformMatrix,tt=Phaser.Math.TransformXY;var et,st,it={},rt=/^[\x00-\x7F]+$/,nt=function(t){return rt.test(t)};const at=E;var ot=function(t,e,s,i,r,n){i<=0&&(s=0);var a=[];if(!t||!t.length)return a;for(var o,h,l,d=0===s,u=t.split(at),c=0,g=u.length;c<g;c++)if(o=u[c],l=c===g-1?0:1,d){var p=e.measureText(o).width;a.push(n.getLine(o,p,l))}else{if(h=0===c?i-r:i,o.length<=100&&(p=e.measureText(o).width)<=h){a.push(n.getLine(o,p,l));continue}for(var f,y,m,v=ht(o,s),x="",w=0,S=0,E=v.length;S<E;S++)if(f=v[S],(y=e.measureText(f).width)>i&&lt(f)){""!==x?a.push(n.getLine(x,w,2)):0===S&&r>0&&a.push(n.getLine("",0,2)),a.push(...ot(f,e,2,i,0,n));var O=a.pop();x=O.text,w=O.width,n.freeLine(O)," "===x&&(x="",w=0)}else(m=w+y)>h?(a.push(n.getLine(x,w,2)),x=f,w=y,h=i):(x+=f,w=m),S===E-1&&a.push(n.getLine(x,w,l))}return a},ht=function(t,e){var s;switch(e){case 1:s=[];for(var i=0,r=(t=t.split(" ")).length;i<r;i++){var n=t[i];i<r-1?s.push(n+" "):""!==n&&s.push(n)}break;case 2:s=t.split("");break;default:for(s=[],i=0,r=(t=t.split(" ")).length;i<r;i++)n=t[i],i<r-1?nt(n)?s.push(n+" "):(s.push(...n.split("")),s.push(" ")):""!==n&&(nt(n)?s.push(n):s.push(...n.split("")))}return s},lt=function(t){switch(t.length){case 1:return!1;case 2:return" "!==t.charAt(1);default:return!0}};const dt=Phaser.Utils.Objects.GetValue;class ut{constructor(t){this.parent=t.parent,this.scene=this.parent.scene,this.context=dt(t,"context",null),this.canvas=this.context.canvas,this.parser=dt(t,"parser",null),this.defaultStyle=dt(t,"style",null),this.autoRound=!0,this.pensPool=t.pensPool,this.linesPool=t.linesPool,this.wrapTextLinesPool=t.wrapTextLinesPool,this.penManager=this.newPenManager(),this._tmpPenManager=null,this.hitAreaManager=new j,this.lastHitAreaKey=null,this.urlTagCursorStyle=null}destroy(){this.parent=void 0,this.scene=void 0,this.context=void 0,this.canvas=void 0,this.parser=void 0,this.defaultStyle=void 0,this.penManager&&(this.penManager.destroy(),this.penManager=void 0),this._tmpPenManager&&(this._tmpPenManager.destroy(),this._tmpPenManager=void 0),this.hitAreaManager&&(this.hitAreaManager.destroy(),this.hitAreaManager=void 0),this.pensPool=void 0,this.linesPool=void 0,this.wrapTextLinesPool=void 0}updatePenManager(t,e,s,i,r){if(void 0===r&&(r=this.penManager),r.clear(),""===t)return r;var n=this.parent.style;if(n.isWrapFitMode){var a=this.parent.padding;s=n.fixedWidth-a.left-a.right}for(var o,h,l,d,u,c=this.canvas,g=this.context,p=0,f=0,y=n.wrapCallback,m=n.wrapCallbackScope,v=!0,x=this.parser.splitText(t),w=this.wrapTextLinesPool,S=0,E=x.length;S<E;S++)if(o=(d=this.parser.tagTextToProp(x[S],h)).plainText,(h=d.prop).img){var O=this.imageManager.getOuterWidth(h.img);s>0&&0!==e&&s<p+O&&(r.addNewLinePen(),f+=i,p=0),r.addImagePen(p,f,O,B(h)),p+=O}else if(""!==o){if(g.save(),(l=this.parser.propToContextStyle(this.defaultStyle,h)).buildFont(),l.syncFont(c,g),l.syncStyle(c,g),y){"string"==typeof(u=y.call(m,o,g,s,p))&&(u=u.split("\n"));for(var C=0,T=u.length;C<T;C++)"string"==typeof(k=u[C])?u[C]=w.getLine(k,g.measureText(k).width,C<T-1?2:0):v=!1}else u=ot(o,g,e,s,p,w);var k;for(C=0,T=u.length;C<T;C++)k=u[C],r.addTextPen(k.text,p,f,k.width,B(h),k.newLineMode),0!==k.newLineMode?(p=0,f+=i):p+=k.width;v&&w.freeLines(u),u=null,g.restore()}for(S=0,E=this.lines.length;S<E;S++){var R=this.lines[S],P=R[R.length-1];P&&(P.width+=this.parser.getStrokeThinkness(this.defaultStyle,P.prop))}return r}get startXOffset(){return this.defaultStyle.xOffset}get startYOffset(){return this.defaultStyle.metrics.ascent}get lines(){return this.penManager.lines}get displayLinesCount(){var t=this.penManager.linesCount,e=this.defaultStyle.maxLines;return e>0&&t>e&&(t=e),t}get linesWidth(){return Math.ceil(this.penManager.getMaxLineWidth())}get linesHeight(){var t=this.displayLinesCount,e=this.defaultStyle.lineHeight*t;return t>0&&(e-=this.defaultStyle.lineSpacing),e}get imageManager(){return this.parent.imageManager}get rtl(){return this.parent.style.rtl}newPenManager(){return new G({pensPool:this.pensPool,linesPool:this.linesPool,tagToText:this.parser.propToTagText,tagToTextScope:this.parser})}get tmpPenManager(){return null===this._tmpPenManager&&(this._tmpPenManager=this.newPenManager()),this._tmpPenManager}getPlainText(t,e,s){var i;if(null==t)i=this.penManager.plainText;else{var r=this.parser.splitText(t,1);i="";for(var n=0,a=r.length;n<a;n++)i+=r[n]}return null==e&&null==s||(null==e&&(e=0),null==s&&(s=i.length),i=i.substring(e,s)),i}getPenManager(t,e){if(void 0===t)return this.copyPenManager(e,this.penManager);void 0===e&&(e=this.newPenManager());var s=this.defaultStyle;return this.updatePenManager(t,s.wrapMode,s.wrapWidth,s.lineHeight,e),e}getText(t,e,s,i){if(null==t)return this.penManager.getSliceTagText(e,s,i);var r=this.tmpPenManager,n=this.defaultStyle;return this.updatePenManager(t,n.wrapMode,n.wrapWidth,n.lineHeight,r),r.getSliceTagText(e,s,i)}copyPenManager(t,e){return void 0===e&&(e=this.penManager),e.copy(t)}getTextWidth(t){return void 0===t&&(t=this.penManager),t.getMaxLineWidth()}getLastPen(t){return void 0===t&&(t=this.penManager),t.lastPen}}var ct={setInteractive:function(){this.parent.on("pointerdown",Y,this).on("pointerup",V,this).on("pointermove",J,this).on("pointerover",J,this).on("pointerout",(function(t,e){J.call(this,t,null,null,e)}),this)},getHitArea:function(t,e,s){var i=function(t,e,s,i,r){void 0===i&&(i=t.scene.cameras.main),void 0===r?r={}:!0===r&&(r=it);var n=i.scrollX,a=i.scrollY,o=e+n*t.scrollFactorX-n,h=s+a*t.scrollFactorY-a;return t.parentContainer?(void 0===et&&(et=new Q,st=new Q),t.getWorldTransformMatrix(et,st),et.applyInverse(o,h,r)):tt(o,h,t.x,t.y,t.rotation,t.scaleX,t.scaleY,r),r.x+=t.displayOriginX,r.y+=t.displayOriginY,r}(this.parent,t,e,s,!0),r=this.hitAreaManager.getFirst(i.x,i.y);if(null!==r)return r.data.key}};Object.assign(ut.prototype,N,ct);class gt extends D{freeLine(t){if(t)return this.push(t),this}freeLines(t){if(t)return this.pushMultiple(t),this}getLine(t,e,s){var i=this.pop();return null===i&&(i={}),i.text=t,i.width=e,i.newLineMode=s,i}}const pt=Phaser.Utils.Objects.IsPlainObject,ft=Phaser.Utils.Objects.GetValue;var yt=function(t,e){pt(t)?t=(e=t).key:void 0===e&&(e={key:t}),e.hasOwnProperty("key")||(e.key=t);var s=e.key,i=e.frame,r=e.width,n=e.height;if(void 0===r||void 0===n){var a=this.textureManager.getFrame(s,i),o=a?a.cutWidth:0,h=a?a.cutHeight:0;void 0===r&&void 0===n?(r=o,n=h):void 0===r?r=o*(n/h):void 0===n&&(n=h*(r/o))}this.images[t]={key:s,frame:i,width:r,height:n,y:ft(e,"y",0),left:ft(e,"left",0),right:ft(e,"right",0),originX:ft(e,"originX",0),originY:ft(e,"originY",0),tintFill:ft(e,"tintFill",!1)}};const mt=Phaser.Display.Canvas.CanvasPool;class vt{constructor(t){this.textureManager=t.sys.textures,this.images={}}destroy(){this.textureManager=void 0,this.images=void 0}add(t,e){if("string"==typeof t)yt.call(this,t,e);else if(Array.isArray(t))for(var s=0,i=(r=t).length;s<i;s++)yt.call(this,r[s]);else{var r=t;for(var t in r)yt.call(this,t,r[t])}return this}has(t){return this.images.hasOwnProperty(t)}remove(t){return this.has(t)&&delete this.images[t],this}get(t){return this.has(t)||this.textureManager.exists(t)&&this.add(t),this.images[t]}getOuterWidth(t){var e=this.get(t);return e?e.width+e.left+e.right:0}getFrame(t){var e=this.get(t);return e?this.textureManager.getFrame(e.key,e.frame):void 0}hasTexture(t){return!!this.getFrame(t)}}var xt={draw:function(t,e,s,i,r,n){var a=this.get(t);if(a){var o=this.textureManager.getFrame(a.key,a.frame),h=a.width,l=a.height;s+=a.left-a.originX*h,i+=a.y-a.originY*l,a.tintFill||(r=void 0),function(t,e,s,i,r,n,a,o){void 0===s&&(s=0),void 0===i&&(i=0),void 0===r&&(r=t.cutWidth),void 0===n&&(n=t.cutHeight),void 0===o&&(o=!1),o&&(s=Math.round(s),i=Math.round(i));var h=e.getContext("2d",{willReadFrequently:!0});if(a){var l=mt.create(null,r,n,Phaser.CANVAS,!0),d=l.getContext("2d",{willReadFrequently:!0});d.drawImage(t.source.image,t.cutX,t.cutY,t.cutWidth,t.cutHeight,0,0,r,n),d.globalCompositeOperation="source-in",d.fillStyle=a,d.fillRect(0,0,r,n),h.drawImage(l,0,0,r,n,s,i,r,n),mt.remove(l)}else h.drawImage(t.source.image,t.cutX,t.cutY,t.cutWidth,t.cutHeight,s,i,r,n)}(o,e.canvas,s,i,h,l,r,n)}}};Object.assign(vt.prototype,xt);const wt=Phaser.Utils.Objects.IsPlainObject,St=Phaser.DOM.AddToDOM,Et=Phaser.Display.Canvas.CanvasPool,Ot=Phaser.GameObjects.GameObject,Ct=Phaser.Utils.Objects.GetValue,Tt=Phaser.DOM.RemoveFromDOM,kt=E,Rt=Phaser.Utils.String.UUID;var Pt=null,_t=null,bt=null;class Lt extends f{constructor(t,e,s,i,r,n,a){if(wt(e)){var o=e;e=Ct(o,"x",0),s=Ct(o,"y",0),i=Ct(o,"text",""),r=Ct(o,"style")}if(void 0===e&&(e=0),void 0===s&&(s=0),super(t,n),this.renderer=t.sys.game.renderer,this.setPosition(e,s),this.setOrigin(0,0),this.initPipeline(),this.initPostPipeline(!0),this.canvas=Et.create(this),this.context=this.canvas.getContext("2d",{willReadFrequently:!0}),this._imageManager=void 0,r){if(r.hasOwnProperty("align")){var h=r.align;delete r.align,r.halign=h}r.hasOwnProperty("stroke")&&!r.hasOwnProperty("strokeThickness")&&(r.strokeThickness=1)}this.style=new k(this,r);var l,d,u,c=Ct(r,"images",void 0);c&&this.addImage(c),this.autoRound=!0,this._text=void 0,this.padding={left:0,right:0,top:0,bottom:0},this.width=1,this.height=1,this.dirty=!1,0===this.style.resolution&&(this.style.resolution=1),this._crop=this.resetCropObject(),this._textureKey=Rt(),this.texture=t.sys.textures.addCanvas(this._textureKey,this.canvas),this.frame=this.texture.get(),this.frame.source.resolution=this.style.resolution,this.renderer&&this.renderer.gl&&(this.renderer.deleteTexture(this.frame.source.glTexture),this.frame.source.glTexture=null),Ct(r,"sharedPool",!0)?(Pt||(Pt={},_t=new D,bt=new gt,this.scene.game.events.once("destroy",(function(){Pt=null,_t=null,bt=null}))),Pt.hasOwnProperty(n)||(Pt[n]=new D),l=Pt[n],d=_t,u=bt):(l=new D,d=new D,u=new gt),this.canvasText=new ut({parent:this,context:this.context,parser:a,style:this.style,pensPool:l,linesPool:d,wrapTextLinesPool:u}),this.parser=a,this.initRTL(),r&&r.padding&&this.setPadding(r.padding),this.setText(i),this.setUrlTagCursorStyle(Ct(r,"urlTagCursorStyle","pointer")),Ct(r,"interactive",!1)&&this.setInteractive()}preDestroy(){Tt(this.canvas),this.canvasText.destroy(),this.canvasText=void 0,this._imageManager&&(this._imageManager.destroy(),this._imageManager=void 0),Et.remove(this.canvas);var t=this.texture;t&&t.destroy()}set text(t){this.setText(t)}get text(){return this._text}initRTL(){this.style.rtl&&(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",St(this.canvas,this.scene.sys.canvas),this.originX=1)}setRTL(t){void 0===t&&(t=!0);var e=this.style;if(e.rtl===t)return this;if(e.rtl=t,t?(this.canvas.dir="rtl",this.context.direction="rtl",this.canvas.style.display="none",St(this.canvas,this.scene.sys.canvas)):(this.canvas.dir="ltr",this.context.direction="ltr"),"left"===e.halign?e.halign="right":"right"===e.halign&&(e.halign="left"),this._imageManager){var s=this._imageManager.images;for(var i in s)s[i].originX=1-s[i].originX}return this}setText(t){return(t=function(t){return null==t?t="":Array.isArray(t)?t=t.join("\n"):"number"==typeof t&&(t=t.toString()),t}(t))===this._text||(this._text=t,this.updateText()),this}setPadding(t,e,s,i){if("object"==typeof t){var r=t,n=Ct(r,"x",null);null!==n?(t=n,s=n):(t=Ct(r,"left",0),s=Ct(r,"right",t));var a=Ct(r,"y",null);null!==a?(e=a,i=a):(e=Ct(r,"top",0),i=Ct(r,"bottom",e))}else void 0===t&&(t=0),void 0===e&&(e=t),void 0===s&&(s=t),void 0===i&&(i=e);return this.padding.left=t,this.padding.top=e,this.padding.right=s,this.padding.bottom=i,this.updateText(!1)}updateText(t){void 0===t&&(t=!0);var e=this.canvasText,s=this.style;t&&e.updatePenManager(this._text,s.wrapMode,s.wrapWidth,s.lineHeight);var i,r,n=this.padding,a=Math.ceil(e.linesWidth);0===s.fixedWidth?(this.width=a+n.left+n.right,i=a):(this.width=s.fixedWidth,(i=this.width-n.left-n.right)<a&&(i=a)),0===s.fixedHeight?(this.height=e.linesHeight+n.top+n.bottom,r=e.linesHeight):(this.height=s.fixedHeight,(r=this.height-n.top-n.bottom)<e.linesHeight&&(r=e.linesHeight));var o=this.width,h=this.height;this.updateDisplayOrigin();var l=s.resolution;o*=l,h*=l,o=Math.max(Math.ceil(o),1),h=Math.max(Math.ceil(h),1);var d=this.canvas,u=this.context;d.width!==o||d.height!==h?(d.width=o,d.height=h,this.frame.setSize(o,h)):u.clearRect(0,0,o,h),u.save(),u.scale(l,l);var c=this.style.rtl?n.right:n.left,g=n.top;e.draw(c,g,i,r),u.restore(),this.renderer&&this.renderer.gl&&(this.frame.source.glTexture=this.renderer.canvasToTexture(d,this.frame.source.glTexture,!0),this.frame.glTexture.spectorMetadata={textureKey:"BBCodeText Game Object"}),this.dirty=!0;var p=this.input;return p&&!p.customHitArea&&(p.hitArea.width=this.width,p.hitArea.height=this.height),this}toJSON(){var t=Components.ToJSON(this),e={autoRound:this.autoRound,text:this._text,style:this.style.toJSON(),resolution:this.resolution,padding:{left:this.padding.left,right:this.padding.right,top:this.padding.top,bottom:this.padding.bottom}};return t.data=e,t}setInteractive(t,e,s){var i=!!this.input;return Ot.prototype.setInteractive.call(this,t,e,s),i||this.canvasText.setInteractive(),this}setUrlTagCursorStyle(t){return this.urlTagCursorStyle=t,this}get urlTagCursorStyle(){return this.canvasText.urlTagCursorStyle}set urlTagCursorStyle(t){this.canvasText.urlTagCursorStyle=t}getWrappedText(t,e,s){return"number"==typeof t&&(s=e,e=t,t=void 0),(t=this.canvasText.getText(t,e,s,!0)).split(kt)}getPlainText(t,e,s){return"number"==typeof t&&(s=e,e=t,t=void 0),this.canvasText.getPlainText(t,e,s)}getText(t,e,s,i){return"number"==typeof t&&(i=s,s=e,e=t,t=void 0),void 0===i&&(i=!1),this.canvasText.getText(t,e,s,i)}getSubString(t,e,s){return"number"==typeof t&&(s=e,e=t,t=void 0),this.getText(t,e,s)}copyPenManager(t){return this.canvasText.copyPenManager(t)}getPenManager(t,e){return this.canvasText.getPenManager(t,e)}setSize(t,e){return this.setFixedSize(t,e)}resize(t,e){return this.setFixedSize(t,e)}get imageManager(){return this._imageManager||(this._imageManager=new vt(this.scene)),this._imageManager}addImage(t,e){return this.imageManager.add(t,e),this}drawAreaBounds(t,e){return this.canvasText.hitAreaManager.drawBounds(t,e,this),this}generateTexture(t,e,s,i,r){var n=this.canvas;return void 0===i?i=n.width:i*=this.resolution,void 0===r?r=n.height:r*=this.resolution,function(t,e,s,i,r,n,a){var o,h=t.sys.textures,l=t.renderer;void 0===i&&(i=0),void 0===r&&(r=0),void 0===n&&(n=e.width),void 0===a&&(a=e.height);var d=(o=h.exists(s)?h.get(s):h.createCanvas(s,n,a)).getSourceImage();d.width!==n&&(d.width=n),d.height!==a&&(d.height=a);var u=d.getContext("2d",{willReadFrequently:!0});u.clearRect(0,0,n,a),u.drawImage(e,i,r,n,a),l.gl&&o&&l.canvasToTexture(d,o.source[0].glTexture,!0,0)}(this.scene,n,t,e,s,i,r),this}getHitArea(t,e,s){return this.canvasText.getHitArea(t,e,s)}}var Mt={appendText:function(t,e){var s;return t||0===t||(t=""),void 0===e&&(e=!0),Array.isArray(t)&&(t=t.join("\n")),(s=e?`${this.text}\n${t}`:`${this.text}${t}`)!=this.text&&this.setText(s),this}};Object.assign(Lt.prototype,Mt);const It=!1,At=!0;var Ft,Nt,Kt={plainText:null,prevProp:null},Wt=function(t,e,s,i){return e===At?t[s]=i:t.hasOwnProperty(s)&&delete t[s],t},Bt=new k,Ht={},$t=function(t){return t.replace(Gt,"\\$&").replace(zt,"\\x2d")},Gt=/[|\\{}()[\]^$+*?.]/g,zt=/-/g,Dt={},Ut=function(t,e,s,i){return void 0===i?`${t}${s}${e}`:`${t}${s}=(${i})${e}`},Xt=function(t,e,s){return`${t}/${s}${e}`},jt="[-.0-9]+",Yt=["[a-zA-Z]+","#[0-9abcdef]+","rgba?\\(s*[.0-9]+s*(,s*[.0-9]+s*){2,3}\\)"].join("|"),Vt=function(t,e){if(void 0===e){var s=t;t=s[0],e=s[1]}if(Ft===t&&Nt===e)return!1;Ft=t,Nt=e,t=$t(t);var i=function(t){return`[^${t}]+`}(e=$t(e)),r=Ut(t,e,"esc"),n=Xt(t,e,"esc"),a=Ut(t,e,"raw"),o=Xt(t,e,"raw"),h=Ut(t,e,"b"),l=Xt(t,e,"b"),d=Ut(t,e,"i"),u=Xt(t,e,"i"),c="weight",g=Ut(t,e,c,jt),p=Xt(t,e,c),f="size",y=Ut(t,e,f,jt),m=Xt(t,e,f),v="family",x=Ut(t,e,v,i),w=Xt(t,e,v),S="color",E=Ut(t,e,S,Yt),O=Xt(t,e,S),C=Ut(t,e,"u"),T=Ut(t,e,"u",Yt),k=Xt(t,e,"u"),R=Ut(t,e,"s"),P=Ut(t,e,"s",Yt),_=Xt(t,e,"s"),b="shadow",L=Ut(t,e,b),M=Ut(t,e,b,Yt),I=Xt(t,e,b),A="stroke",F=Ut(t,e,A),N=Ut(t,e,A,Yt),K=Xt(t,e,A),W="bgcolor",B=Ut(t,e,W,Yt),H=Xt(t,e,W),$=Ut(t,e,"y",jt),G=Xt(t,e,"y"),z=Ut(t,e,"img",i),D=Xt(t,e,"img"),U="area",X=Ut(t,e,U,i),j=Xt(t,e,U),Y=Ut(t,e,"url",i),V=Xt(t,e,"url"),J="align",Z=Ut(t,e,J,i),q=Xt(t,e,J),Q=Ut(t,e,"id",i),tt=Xt(t,e,"id");return Dt.RE_ESC_OPEN=new RegExp(r,"i"),Dt.RE_ESC_CLOSE=new RegExp(n,"i"),Dt.RE_RAW_OPEN=new RegExp(a,"i"),Dt.RE_RAW_CLOSE=new RegExp(o,"i"),Dt.RE_BLOD_OPEN=new RegExp(h,"i"),Dt.RE_BLOD_CLOSE=new RegExp(l,"i"),Dt.RE_ITALICS_OPEN=new RegExp(d,"i"),Dt.RE_ITALICS_CLOSE=new RegExp(u,"i"),Dt.RE_WEIGHT_OPEN=new RegExp(g,"i"),Dt.RE_WEIGHT_CLOSE=new RegExp(p,"i"),Dt.RE_SIZE_OPEN=new RegExp(y,"i"),Dt.RE_SIZE_CLOSE=new RegExp(m,"i"),Dt.RE_FAMILY_OPEN=new RegExp(x,"i"),Dt.RE_FAMILY_CLOSE=new RegExp(w,"i"),Dt.RE_COLOR_OPEN=new RegExp(E,"i"),Dt.RE_COLOR_CLOSE=new RegExp(O,"i"),Dt.RE_UNDERLINE_OPEN=new RegExp(C,"i"),Dt.RE_UNDERLINE_OPENC=new RegExp(T,"i"),Dt.RE_UNDERLINE_CLOSE=new RegExp(k,"i"),Dt.RE_STRIKETHROUGH_OPEN=new RegExp(R,"i"),Dt.RE_STRIKETHROUGH_OPENC=new RegExp(P,"i"),Dt.RE_STRIKETHROUGH_CLOSE=new RegExp(_,"i"),Dt.RE_SHADOW_OPEN=new RegExp(L,"i"),Dt.RE_SHADOW_OPENC=new RegExp(M,"i"),Dt.RE_SHADOW_CLOSE=new RegExp(I,"i"),Dt.RE_STROKE_OPEN=new RegExp(F,"i"),Dt.RE_STROKE_OPENC=new RegExp(N,"i"),Dt.RE_STROKE_CLOSE=new RegExp(K,"i"),Dt.RE_BGCOLOR_OPEN=new RegExp(B,"i"),Dt.RE_BGCOLOR_CLOSE=new RegExp(H,"i"),Dt.RE_OFFSETY_OPEN=new RegExp($,"i"),Dt.RE_OFFSETY_CLOSE=new RegExp(G,"i"),Dt.RE_IMAGE_OPEN=new RegExp(z,"i"),Dt.RE_IMAGE_CLOSE=new RegExp(D,"i"),Dt.RE_AREA_OPEN=new RegExp(X,"i"),Dt.RE_AREA_CLOSE=new RegExp(j,"i"),Dt.RE_URL_OPEN=new RegExp(Y,"i"),Dt.RE_URL_CLOSE=new RegExp(V,"i"),Dt.RE_ALIGN_OPEN=new RegExp(Z,"i"),Dt.RE_ALIGN_CLOSE=new RegExp(q,"i"),Dt.RE_ID_OPEN=new RegExp(Q,"i"),Dt.RE_ID_CLOSE=new RegExp(tt,"i"),Dt.RE_SPLITTEXT=new RegExp([a,o,r,n,h,l,d,u,g,p,y,m,x,w,E,O,C,T,k,R,P,_,L,M,I,F,N,K,B,H,$,G,z,D,X,j,Y,V,Z,q,Q,tt].join("|"),"ig"),!0},Jt=function(t,e){return void 0!==t&&Vt(t,e),Object.assign({},Dt)};const Zt=Phaser.Utils.Objects.GetValue;class qt{constructor(t){var e=Zt(t,"delimiters","[]");this.tagRegex=Jt(e),this.delimiters=e}getStrokeThinkness(t,e){return e.hasOwnProperty("stroke")?t.strokeThickness:0}setDelimiters(t,e){return Vt(t,e)&&(this.tagRegex=Jt()),this}}var Qt={splitText:function(t,e){for(var s=this.tagRegex,i=[],r=0,n=!1,a=!1;;){var o=s.RE_SPLITTEXT.exec(t);if(!o)break;var h=o[0];if(a){if(!s.RE_ESC_CLOSE.test(h))continue;a=!1}else if(n){if(!s.RE_RAW_CLOSE.test(h))continue;n=!1}else s.RE_ESC_OPEN.test(h)?a=!0:s.RE_RAW_OPEN.test(h)&&(n=!0);var l=s.RE_SPLITTEXT.lastIndex,d=l-h.length;if(r<d){var u=t.substring(r,d);i.push(u)}void 0===e&&i.push(h),r=l}var c=t.length;return r<c&&i.push(t.substring(r,c)),i},tagTextToProp:function(t,e){var s=this.tagRegex;null==e&&(e={});var i="";if(e.img&&Wt(e,It,"img"),e.esc)s.RE_ESC_CLOSE.test(t)?Wt(e,It,"esc"):i=t;else if(e.raw)s.RE_RAW_CLOSE.test(t)?Wt(e,It,"raw"):i=t;else if(s.RE_ESC_OPEN.test(t))Wt(e,At,"esc",!0);else if(s.RE_ESC_CLOSE.test(t))Wt(e,It,"esc");else if(s.RE_RAW_OPEN.test(t))Wt(e,At,"raw",!0);else if(s.RE_RAW_CLOSE.test(t))Wt(e,It,"raw");else if(s.RE_BLOD_OPEN.test(t))Wt(e,At,"b",!0);else if(s.RE_BLOD_CLOSE.test(t))Wt(e,It,"b");else if(s.RE_ITALICS_OPEN.test(t))Wt(e,At,"i",!0);else if(s.RE_ITALICS_CLOSE.test(t))Wt(e,It,"i");else if(s.RE_WEIGHT_OPEN.test(t)){var r=t.match(s.RE_WEIGHT_OPEN);Wt(e,At,"weight",r[1])}else s.RE_WEIGHT_CLOSE.test(t)?Wt(e,It,"weight"):s.RE_SIZE_OPEN.test(t)?(r=t.match(s.RE_SIZE_OPEN),Wt(e,At,"size",`${r[1]}px`)):s.RE_SIZE_CLOSE.test(t)?Wt(e,It,"size"):s.RE_FAMILY_OPEN.test(t)?(r=t.match(s.RE_FAMILY_OPEN),Wt(e,At,"family",r[1])):s.RE_FAMILY_CLOSE.test(t)?Wt(e,It,"family"):s.RE_COLOR_OPEN.test(t)?(r=t.match(s.RE_COLOR_OPEN),Wt(e,At,"color",r[1])):s.RE_COLOR_CLOSE.test(t)?Wt(e,It,"color"):s.RE_UNDERLINE_OPEN.test(t)?Wt(e,At,"u",!0):s.RE_UNDERLINE_OPENC.test(t)?(r=t.match(s.RE_UNDERLINE_OPENC),Wt(e,At,"u",r[1])):s.RE_UNDERLINE_CLOSE.test(t)?Wt(e,It,"u"):s.RE_STRIKETHROUGH_OPEN.test(t)?Wt(e,At,"s",!0):s.RE_STRIKETHROUGH_OPENC.test(t)?(r=t.match(s.RE_STRIKETHROUGH_OPENC),Wt(e,At,"s",r[1])):s.RE_STRIKETHROUGH_CLOSE.test(t)?Wt(e,It,"s"):s.RE_SHADOW_OPEN.test(t)?Wt(e,At,"shadow",!0):s.RE_SHADOW_OPENC.test(t)?(r=t.match(s.RE_SHADOW_OPENC),Wt(e,At,"shadow",r[1])):s.RE_SHADOW_CLOSE.test(t)?Wt(e,It,"shadow"):s.RE_STROKE_OPEN.test(t)?Wt(e,At,"stroke",!0):s.RE_STROKE_OPENC.test(t)?(r=t.match(s.RE_STROKE_OPENC),Wt(e,At,"stroke",r[1])):s.RE_STROKE_CLOSE.test(t)?Wt(e,It,"stroke"):s.RE_BGCOLOR_OPEN.test(t)?(r=t.match(s.RE_BGCOLOR_OPEN),Wt(e,At,"bgcolor",r[1])):s.RE_BGCOLOR_CLOSE.test(t)?Wt(e,It,"bgcolor"):s.RE_OFFSETY_OPEN.test(t)?(r=t.match(s.RE_OFFSETY_OPEN),Wt(e,At,"y",parseFloat(r[1]))):s.RE_OFFSETY_CLOSE.test(t)?Wt(e,It,"y"):s.RE_IMAGE_OPEN.test(t)?(r=t.match(s.RE_IMAGE_OPEN),Wt(e,At,"img",r[1])):s.RE_IMAGE_CLOSE.test(t)?Wt(e,It,"img"):s.RE_AREA_OPEN.test(t)?(r=t.match(s.RE_AREA_OPEN),Wt(e,At,"area",r[1])):s.RE_AREA_CLOSE.test(t)?Wt(e,It,"area"):s.RE_URL_OPEN.test(t)?(r=t.match(s.RE_URL_OPEN),Wt(e,At,"url",r[1])):s.RE_URL_CLOSE.test(t)?Wt(e,It,"url"):s.RE_ALIGN_OPEN.test(t)?(r=t.match(s.RE_ALIGN_OPEN),Wt(e,At,"align",r[1])):s.RE_ALIGN_CLOSE.test(t)?Wt(e,It,"align"):s.RE_ID_OPEN.test(t)?(r=t.match(s.RE_ID_OPEN),Wt(e,At,"id",r[1])):s.RE_ID_CLOSE.test(t)?Wt(e,It,"id"):i=t;var n=Kt;return n.plainText=i,n.prop=e,n},propToContextStyle:function(t,e){var s=Bt;if(e.hasOwnProperty("img"))s.image=e.img;else{if(s.image=null,e.hasOwnProperty("family")?s.fontFamily=e.family:s.fontFamily=t.fontFamily,e.hasOwnProperty("size")){var i=e.size;"number"==typeof i&&(i=`${i}px`),s.fontSize=i}else s.fontSize=t.fontSize;s.fontStyle=function(t){var e=t.b,s=t.weight,i=t.i;return e||s||i?i?e?"bold italic":s?`${s} italic`:"italic":e?"bold":s.toString():""}(e),e.hasOwnProperty("color")?s.color=e.color:s.color=t.color,e.hasOwnProperty("stroke")?!0===e.stroke?(s.stroke=t.stroke,s.strokeThickness=t.strokeThickness):(s.stroke=e.stroke,s.strokeThickness=t.strokeThickness):(s.stroke=t.stroke,s.strokeThickness=0)}return e.hasOwnProperty("shadow")?!0===e.shadow?(s.shadowColor=t.shadowColor,s.shadowOffsetX=t.shadowOffsetX,s.shadowOffsetY=t.shadowOffsetY,s.shadowBlur=t.shadowBlur,s.shadowStroke=!0,s.shadowFill=!0):(s.shadowColor=e.shadow,s.shadowOffsetX=t.shadowOffsetX,s.shadowOffsetY=t.shadowOffsetY,s.shadowBlur=t.shadowBlur,s.shadowStroke=!0,s.shadowFill=!0):(s.shadowColor="#000",s.shadowOffsetX=0,s.shadowOffsetY=0,s.shadowBlur=0,s.shadowStroke=!1,s.shadowFill=!1),e.hasOwnProperty("u")?!0===e.u?(s.underlineColor=t.underlineColor,s.underlineThickness=t.underlineThickness,s.underlineOffset=t.underlineOffset):(s.underlineColor=e.u,s.underlineThickness=t.underlineThickness,s.underlineOffset=t.underlineOffset):(s.underlineColor="#000",s.underlineThickness=0,s.underlineOffset=0),e.hasOwnProperty("s")?!0===e.s?(s.strikethroughColor=t.strikethroughColor,s.strikethroughThickness=t.strikethroughThickness,s.strikethroughOffset=t.strikethroughOffset):(s.strikethroughColor=e.s,s.strikethroughThickness=t.strikethroughThickness,s.strikethroughOffset=t.strikethroughOffset):(s.strikethroughColor="#000",s.strikethroughThickness=0,s.strikethroughOffset=0),e.hasOwnProperty("bgcolor")?s.bgcolor=e.bgcolor:s.bgcolor=null,s},propToTagText:function(t,e,s){null==s&&(s=Ht);var i=this.delimiters[0],r=this.delimiters[1],n=[];for(var a in s)e.hasOwnProperty(a)||n.push(`${i}/${a}${r}`);for(var a in e){var o=e[a];if("img"===a);else if(s[a]===o)continue;switch(a){case"size":n.push(`${i}size=${o.replace("px","")}${r}`);break;case"color":case"weight":case"family":case"stroke":case"bgcolor":case"y":case"img":case"area":case"url":case"align":case"id":n.push(`${i}${a}=${o}${r}`);break;case"u":case"s":!0===o?n.push(`${i}${a}${r}`):n.push(`${i}${a}=${o}${r}`);break;default:n.push(`${i}${a}${r}`)}}return n.push(t),n.join("")}};Object.assign(qt.prototype,Qt);class te extends Lt{constructor(t,e,s,i,r){super(t,e,s,i,r,"rexBBCodeText",new qt(r))}setDelimiters(t,e){return this.parser.setDelimiters(t,e),this}}function ee(t,e,s,i){var r=new te(this.scene,t,e,s,i);return this.scene.add.existing(r),r}const se=Phaser.Utils.Objects.GetAdvancedValue,ie=Phaser.GameObjects.BuildGameObject;function re(t,e){void 0===t&&(t={}),void 0!==e&&(t.add=e);var s=se(t,"text",""),i=se(t,"style",null),r=se(t,"padding",null);null!==r&&(i.padding=r);var n=new te(this.scene,0,0,s,i);return ie(this.scene,n,t),n.autoRound=se(t,"autoRound",!0),n}var ne=function(t){return null==t||""===t||0===t.length};class ae extends Phaser.Plugins.BasePlugin{constructor(t){super(t),t.registerGameObject("rexBBCodeText",ee,re)}start(){this.game.events.on("destroy",this.destroy,this)}}!function(t,e,s,i){if(void 0===i&&(i="."),"object"==typeof t)if(ne(e)){if(null==s)return;"object"==typeof s&&(t=s)}else{"string"==typeof e&&(e=e.split(i));var r=e.pop(),n=function(t,e){var s=t;if(ne(e));else{var i;"string"==typeof e&&(e=e.split("."));for(var r=0,n=e.length;r<n;r++){var a;null!=s[i=e[r]]&&"object"==typeof s[i]||(a={},s[i]=a),s=s[i]}}return s}(t,e);n[r]=s}}(window,"RexPlugins.GameObjects.BBCodeText",te);const oe={type:Phaser.AUTO,width:1024,height:768,parent:"game-container",backgroundColor:"#028af8",resolution:window.devicePixelRatio,scale:{mode:Phaser.Scale.FIT,autoCenter:Phaser.Scale.CENTER_BOTH},plugins:{global:[{key:"rexBBCodeTextPlugin",plugin:ae,start:!0}]},scene:[r,l,o,h,n,a],version:.1},he=document.getElementById("jsonfile");he.addEventListener("change",(t=>{const e=t.target.files[0];let s=null;if(e){console.log(`uploaded ${e.name}`);const t=new FileReader;t.onload=t=>{console.log("onload");try{s=JSON.parse(t.target.result),console.log(s),window.stageData=s,new i.Game({...oe,parent:"game-container"})}catch(e){console.error(e)}},t.onerror=t=>{console.error(error)},t.readAsText(e),he.parentNode.removeChild(he)}}));
